@using Microsoft.Extensions.Localization
@using TrandingSystem.Controllers
@inject IStringLocalizer<VideosController> Localizer
@{
    ViewData["Title"] = "AddNewVideo";
    Layout = "~/Views/Shared/_LayoutDasbord.cshtml";
}

@await Html.PartialAsync("_PartialAddVideo")

 
<script>
        function sweat(){
        let setting={
            text:"ddd",
            title:"erwer"
        }
       SweatAlterProcessing(setting);
    }


        // Submit New Video
       function SubmitAddNewVideo() {
        debugger
        var form = $('#AddNewVideoForm')[0];
        var data = new FormData(form);
        var token = $('input[name="__RequestVerificationToken"]').val();

        const isValid = FinalCheckVaildtion(); // ← هنا نستخدم القيمة المرجعة

        console.log("--------------------fORM Data---------------");
        console.log(form);

        if (!isValid) return;

        let setting = {
            title: "@Localizer["loading"]"
        };
        SweatAlterProcessing(setting);

        $.ajax({
            type: "POST",
            url: "/Videos/SubmitAddNewVideo",
            data: data,
            processData: false,
            contentType: false,
            headers: {
                'RequestVerificationToken': token
            },
            success: function (res) {
                Swal.close();

                if (typeof res === "string" && res.includes("updateVideoForm")) {
                    $("#mainPartial").html(res);
                    return;
                }

                if (res.success) {
                    const modalInstance = bootstrap.Modal.getInstance(document.getElementById('largeModal'));
                    if (modalInstance) modalInstance.hide();

                    SweatAlterSuccess(res.message);
                } else {
                    SweatAlterDanger(res.message);
                }
            },
            error: function () {
                const modalInstance = bootstrap.Modal.getInstance(document.getElementById('largeModal'));
                if (modalInstance) modalInstance.hide();

                SweatAlterDanger("@Localizer["VideoSubmitError"]");
            }
        });
    }

        function FinalCheckVaildtion() {
        let isValid = true;

        if (!GeneralRequiredFiled('InputTitleAR', '@Html.Raw(Localizer["Required"])', 'TitleAR')) {
            isValid = false;
        }

        if (!GeneralRequiredFiled('InputTitleEN', '@Html.Raw(Localizer["Required"])', 'TitleEN')) {
            isValid = false;
        }

        if (!GeneralRequiredFiled('inputDescriptionEN', '@Html.Raw(Localizer["Required"])', 'DescriptionEN')) {
            isValid = false;
        }

        if (!GeneralRequiredFiled('IputDescriptionAR', '@Html.Raw(Localizer["Required"])', 'DescriptionAR')) {
            isValid = false;
        }

        if (!GeneralRequiredFiled('SelectCourseId', '@Html.Raw(Localizer["Required"])', 'CourseId')) {
            isValid = false;
        }

        if (!validateImageFile('InputImageVideoUrl', 'ImageVideoUrl', '@Html.Raw(Localizer["AllowImageExtntion"])')) {
            isValid = false;
        }

        if (!GeneralRequiredFiled('inputVideoUrl', '@Html.Raw(@Localizer["Required"])', 'VideoUrl')) {
            isValid = false;
        }

        if (!handleIsPaidChangeInAddNewVideo('Ispaid', 'Costadd')) {
            isValid = false;
        }
        
          if (!validateCost('@Html.Raw(Localizer["InvaildCost"])','Ispaid','Costadd','spanCost','@Html.Raw(Localizer["Nagtivenumber"])','@Html.Raw(Localizer["CostForPaid"])')) {
            isValid = false;
        }

        return isValid;
    }


</script>

