@using Microsoft.Extensions.Localization
@using TrandingSystem.Application.Dtos
@using TrandingSystem.Controllers
@model CommunityCreateDto
@inject IStringLocalizer<CommunitiesController> Localizer






    <div class="card shadow-lg rounded-3">
        <div class="card-header  text-white text-center">
            <h4>@Localizer["Add"]</h4>
        </div>
        <div class="card-body">
            <form  method="post" id="AddNewCommForm">
            @Html.AntiForgeryToken()

                <div class="form-group mb-3">
                <label class="form-label">@Localizer["CommName"]</label>
                <input asp-for="Title" id="inputTitle" class="form-control" placeholder="@Localizer["EnterTitle"]" oninput="GeneralRequiredFiled('inputTitle', '@Localizer["Required"]', 'Title')" />
                <span asp-validation-for="Title" id="Title" class="text-danger"></span>
                </div>

                <div class="form-check mb-3">
                    <label class="form-check-label">@Localizer["DefualtComm"]</label>
                <input asp-for="IsDefault" class="form-check-input" type="checkbox" id="checkboxDefualtComm" />
                    
                </div>

                <div class="form-group mb-3 " id="courseComm">
                <label class="form-label">@Localizer["ChoiseCourseComm"]</label>

                    <select class="form-control" asp-for="CourseId" id="SelectCourseId">
                        @if (ViewBag.Courses != null)
                        {
                            foreach (var course in (IEnumerable<CourseDto>)ViewBag.Courses)
                            {
                                <option value="@course.CourseId">@course.TitleEN</option>
                            }
                        }
                    </select>     
                </div>

                <div class="form-check mb-3">
                    <label class="form-check-label"> @Localizer["ClosComm"]</label>
                    <input asp-for="IsClosed" class="form-check-input" type="checkbox" />
                   
                </div>

                <div class="form-check mb-3">
                    <label class="form-check-label">@Localizer["OnlyAdmin"]</label>
                    <input asp-for="IsAdminOnly" class="form-check-input" type="checkbox"  />
                    
                </div>

            <button type="button" class="btn btn-success px-4" id="SaveComm">@Localizer["Save"]</button>
            </form>
        </div>
    </div>
    <script>

          $("#checkboxDefualtComm").change(function () {
        if ($("#checkboxDefualtComm").is(":checked")) {
            console.log('good')
           $("#courseComm").addClass("collapse")
        } else {
             console.log(' not good')
            $("#courseComm").removeClass("collapse")
        }
    });

            // Submit Add New Comm
        $("#SaveComm").click(function (e) {
                        console.log('good form')


            // Get Data of Form
            var form = $('#AddNewCommForm')[0];
            // Convert Data To Class
            var data = new FormData(form);
            // Get Token Of Crs
            var token = $('input[name="__RequestVerificationToken"]').val();

            if (GeneralRequiredFiled('inputTitle','@Html.Raw(Localizer["Required"])', 'Title')) {
                let setting = {
                    title: "@Localizer["loading"]"
                };
                bootstrap.Modal.getInstance(document.getElementById('SmallModal')).hide()
                SweatAlterProcessing(setting);

                $.ajax({
                    url: "/Communities/SubmitAddCommunity",
                    type: 'POST',
                    data: data,
                    processData: false,
                    contentType: false,
                    headers: {
                        'RequestVerificationToken': token // تأكد من الاسم ده
                    },
                    success: function (res) {
                        Swal.close();
                        if (res.success) {
                               Swal.fire({
        icon: "success",
        title: res.message,
    }).then((result) => {
        if (result.isConfirmed || result.isDismissed) {
            let Courseid=$("#Course").val();
                LoadingCommunities(Courseid);
        }
    });
                            // هنا ممكن تعمل refresh للجدول أو تضيف العنصر الجديد
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: res.message,
                                
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.close();
                        Swal.fire({
                            icon: "error",
                            title: "@Localizer["Error"]",
                            text: "Something went wrong: " + error
                        });
                    }
                })
            }
        });

    </script>

    

